live data center migrat across wan: a robust cooper context awar approach k.k. ramakrishnan, prashant shenoi   , jacobu van der merw at&t lab-research /   univers of massachusett abstract a signific concern for internet-base servic provid is the continu oper and avail of servic in the face of  outag, whether plan or unplan. in thi paper we advoc a cooper, context-awar approach to data center migrat across wan to deal with outag in a non-disrupt manner. we specif seek to achiev high avail of data center servic in the face of both plan and unanticip outag of data center facil. we make us of server virtual technolog to  enabl the replic and migrat of server function. we propos new network function to enabl server migrat and replic across wide area network (e.g., the internet), and final show the util of intellig and dynam storag replic technolog to ensur applic have access to data in the face of outag with veri tight recoveri point object. categori and subject descriptor c.2.4 [comput-commun network]: distribut  system gener term design, reliabl 1. introduct a signific concern for internet-base servic provid is the continu oper and avail of servic in the face of  outag, whether plan or unplan. these concern ar  exacerb by the increas us of the internet for mission critic  busi and real-time entertain applic. a rel minor outag can disrupt and inconveni a larg number of user.  todai these servic ar almost exclus host in data center. recent advanc in server virtual technolog [8, 14, 22] allow for the live migrat of servic within a local area network (lan) environ. in the lan environ, these  technolog have proven to be a veri effect tool to enabl data center manag in a non-disrupt fashion. not onli can it support plan mainten event [8], but it can also be us in a more dynam fashion to automat balanc load between the  physic server in a data center [22]. when us these technolog in a lan environ, servic execut in a virtual server, and the migrat servic provid by the underli virtual  framework allow for a virtual server to be migrat from on physic server to anoth, without ani signific downtim for the servic or applic. in particular, sinc the virtual server retain the same network address as befor, ani ongo network level  interact ar not disrupt. similarli, in a lan environ, storag requir ar normal met via either network attach storag (na) or via a storag area network (san) which is still  reachabl from the new physic server locat to allow for continu storag access. unfortun in a wide area environ (wan), live server migrat is not as easili achiev for two reason: first, live migrat requir the virtual server to maintain the same network address so that from a network connect viewpoint the migrat server is indistinguish from the origin. while thi is fairli easili achiev in a share lan environ, no current  mechan ar avail to effici achiev the same feat in a wan environ. second, while fairli sophist remot  replic mechan have been develop in the context of disast recoveri [20, 7, 11], these mechan ar ill suit to live data center migrat, becaus in gener the avail technolog ar unawar of applic/servic level semant. in thi paper we outlin a design for live servic migrat across wan. our design make us of exist server virtual  technolog and propos network and storag mechan to facilit migrat across a wan. the essenc of our approach is  cooper, context awar migrat, where a migrat manag  system orchestr the data center migrat across all three  subsystem involv, name the server platform, the wide area network and the disk storag system. while conceptu similar in natur to the lan base work describ abov, us migrat  technolog across a wide area network present uniqu challeng and ha to our knowledg not been achiev. our main contribut is the design of a framework that will allow the migrat across a wan of all subsystem involv with enabl data center servic. we describ new mechan as well as extens to exist  technolog to enabl thi and outlin the cooper, context awar function need across the differ subsystem to enabl thi. 262 2. live data center migrat across wan three essenti subsystem ar involv with host servic in a data center: first, the server host the applic or servic logic. second, servic ar normal host in a data center to provid share access through a network, either the internet or virtual  privat network (vpn). final, most applic requir disk  storag for store data and the amount of disk space and the frequenc of access vari greatli between differ servic/applic. disrupt, failur, or in gener, outag of ani kind of ani of these compon will caus servic disrupt. for thi  reason, prior work and current practic have address the  robust of individu compon. for exampl, data center typic have multipl network connect and redund lan devic to ensur redund at the network level. similarli, physic server ar be design with redund hot-swappabl  compon (disk, processor blade, power suppli etc). final,  redund at the storag level can be provid through sophist data mirror technolog. the focu of our work, howev, is on the case where such  local redund mechan ar not suffici. specif, we ar interest in provid servic avail when the data center as a whole becom unavail, for exampl becaus of data center wide mainten oper, or becaus of catastroph event. as such, our basic approach is to migrat servic between data center across the wide ar network (wan). by necess, move or migrat servic from on data center to anoth need to consid all three of these compon.  histor, such migrat ha been disrupt in natur, requir downtim of the actual servic involv, or requir heavi weight replic techniqu. in the latter case concurr run  replica of a servic can be made avail thu allow a subset of the servic to be migrat or maintain without impact the  servic as a whole. we argu that these exist mechan ar  inadequ to meet the need of network-base servic, includ real-time servic, in term of continu avail and  oper. instead, we advoc an approach where server, network and storag subsystem cooper and coordin action, in a manner that is cogniz of the servic context in order to realiz seamless migrat across wide area network. in thi section we briefli describ the technic build block that would enabl our approach. as outlin below, some of these build block exist, or exist in part, while in other case we us the desir for high avail of servic as the driver for the chang we ar propos. 2.1 live virtual server migrat the main enabl for our approach is the live server migrat capabl that have been develop in the context of server  virtual in recent year [5, 8]. in thi approach an entir run oper system (includ ani activ applic) execut as a virtual server is be transfer from on physic machin to anoth. sinc the virtual server is migrat in it entireti, both  applic and kernel level state get migrat, includ ani state associ with ongo network connect. assum that  network level reachabl to the virtual server"s network address ar maintain after the migrat, the implic is that applic execut in the virtual server experi veri littl downtim (in the order of ten to hundr of millisecond) and ongo network connect remain intact. in order to maintain network level reachabl, the ip address(es) associ with the virtual server ha to be reachabl at the physic server where the virtual server is migrat to. in a lan  environ thi is achiev either by issu an unsolicit arp repli to establish the bind between the new mac address and the ip  address, or by reli on layer-two technolog to allow the virtual server to reus it (old) mac address [8]. becaus of the difficulti of move network level (i.e., ip  address) in a rout non-lan environ, us of live server  migrat as a manag tool ha been limit to the lan  environ [22]. howev, virtual server migrat across the wide area will also be an attract tool, specif to deal with outag, and therefor propos network mechan to enabl thi. if disk storag need ar be met with network attach storag (na), the storag becom just anoth network base applic and can therefor be address in the same wai with lan base migrat [8]. modern virtual environ also includ support for other form of (local) storag includ storag area network (san) [23]. howev, sinc we propos to us wan server migrat as a mean to deal with complet data center  outag, these mechan ar inadequ for our purpos and below we propos extens to remot replic technolog which can work in concert with server migrat to minim servic  downtim. 2.2 network requir from the discuss abov, a kei requir for live server  migrat across a wan is the abil to have the ip address(es) of the virtual server be reachabl at the new data center locat  immedi after the migrat ha complet. thi present a signific challeng for a number of reason. first, despit decad of work in thi area, ip address mobil remain an unresolv problem that is typic onli address at manual configur time scale. the second challeng come from the fact that current rout  protocol ar well known to have converg issu which is ill suit to the time constraint impos by live migrat. third, in todai"s wan network environ connect chang ar typic initi, and control, by network oper or network  manag system. again thi is poorli suit to wan server migrat where it is essenti that the migrat softwar, which is close monitor the statu of the server migrat process, initi thi chang at the appropri time. our approach to address the network requir for live wan migrat build on the observ that not all network chang in thi approach ar time critic and further that  instantan chang ar best achiev in a local manner.  specif, in our solut, describ in detail in section 3, we allow the migrat softwar to initi the necessari network chang as soon as the need for migrat ha been identifi. we make us of tunnel technolog dure thi initi phase to preemptiv establish connect between the data center involv. onc server migrat is complet, the migrat softwar initi a  local chang to direct traffic toward the new data center via the  tunnel. slower time scale network chang then phase out thi local network connect chang for a more optim network wide path to the new data center. 2.3 storag replic requir data avail is typic address by replic busi data on a local/primari storag system, to some remot locat from where it can be access. from a busi/usabl point of view, such remot replic is driven by two metric [9]. first 263 is the recoveri-point-object which is the consist data point to which data can be restor after a disast. second is the  recoverytim-object which is the time it take to recov to that consist data point after a disast [13]. remot replic can be broadli classifi into the follow two categori: ¡ synchron replic: everi data block written to a local storag system is replic to the remot locat befor the local write oper return. ¡ asynchron replic: in thi case the local and remot storag system ar allow to diverg. the amount of  diverg between the local and remot copi is typic bound by either a certain amount of data, or by a certain amount of time. synchron replic is normal recommend for  applic, such as financi databas, where consist between local and remot storag system is a high prioriti. howev, these  desir properti come at a price. first, becaus everi data block need to be replic remot, synchron replic system can not benefit from ani local write coalesc of data if the same data block ar written repeatedli [16]. second, becaus data have to be copi to the remot locat befor the write oper  return, synchron replic ha a direct perform impact on the applic, sinc both lower throughput and increas latenc of the path between the primari and the remot system ar  reflect in the time it take for the local disk write to complet. an altern is to us asynchron replic. howev,  becaus the local and remot system ar allow to diverg,  asynchron replic alwai involv some data loss in the event of a failur of the primari system. but, becaus write oper can be batch and pipelin, asynchron replic system can move data across the network in a much more effici  manner than synchron replic system. for wan live server migrat we seek a more flexibl  replic system where the mode can be dictat by the migrat  semant. specif, to support live server migrat we propos a remot replic system where the initi transfer of data between the data center is perform via asynchron replic to  benefit from the effici of that mode of oper. when the bulk of the data have been transfer in thi manner, replic switch to synchron replic in anticip of the complet of the server migrat step. the final server migrat step trigger a  simultan switch-over to the storag system at the new data  center. in thi manner, when the virtual server start execut in the new data center, storag requir can be local met. 3. wan migrat scenario in thi section we illustr how our cooper, context awar approach can combin the technic build block describ in the previou section to realiz live server migrat across a wide area network. we demonstr how the coordin of server  virtual and migrat technolog, the storag replic  subsystem and the network can achiev live migrat of the entir data center across the wan. we util differ scenario to  demonstr our approach. in section 3.1 we outlin how our approach can be us to achiev the safe live migrat of a data center when plan mainten event ar handl. in section 3.2 we show the us of live server migrat to mitig the effect of unplan outag or failur. 3.1 mainten outag we deal with mainten outag in two part. first, we  consid the case where the servic ha no (or veri limit) storag requir. thi might for exampl be the case with a network element such as a voic-over-ip (voip) gatewai. second, we deal with the more gener case where the servic also requir the  migrat of data storag to the new data center. without requir storag to be migrat: without storag to be replic, the primari compon that we need to coordin ar the server migrat and network mobil. figur 1 show the environ where the applic run in a virtual server vs ha to be move from a physic server in data center a to a physic server in data center b. prior to the mainten event, the coordin migrat  manag system (mm) would signal to both the server  manag system as well as the network that a migrat is immin. the server manag system would initi the migrat of the virtual server from physic server a (¢¤£¦¥ ) to physic server b (¢¤£¦§ ). after an initi bulk state transfer as prepar for  migrat, the server manag system will mirror ani state chang between the two virtual server. similarli, for the network part, base on the signal receiv from the mm, the servic provid edg (¢©¨ ) router will  initi a number of step to prepar for the migrat. specif, as shown in figur 1(b), the migrat system will caus the  network to creat a tunnel between ¢©¨ and ¢©¨ which will be us subsequ to transfer data destin to vs to data center b. when the mm determin a conveni point to quiesc the vs, anoth signal is sent to both the server manag system and the network. for the server manag system, thi signal will indic the final migrat of the vs from data center a to data center b, i.e., after thi the vs will becom activ in data center b. for the network, thi second signal enabl the network data path to switchov local at ¢©¨©¥ to the remot data center. specif, from thi point in time, ani traffic destin for the virtual server address that arriv at ¢©¨©¥ will be switch onto the tunnel to ¢©¨©§ for deliveri to data center b. note that at thi point, from a server perspect the migrat is complet as the vs is now activ in data center b. howev, traffic is sub-optim flow first to ¢©¨©¥ and then across the tunnel to ¢©¨¤§ . to rectifi thi situat anoth network step is  involv. specif, ¢©¨©§ start to advertis a more prefer rout to reach vs, than the rout current be advertis by ¢©¨¤¥ . in thi manner, as ingress pe to the network (¢©¨¤ to ¢©¨¤ in  figur 1) receiv the more prefer rout, traffic will start to flow to ¢©¨©§ directli and the tunnel between ¢©¨©¥ and ¢©¨©§ can be torn down lead to the final state shown in figur 1(c). requir storag migrat: when storag ha to also be  replic, it is critic that we achiev the right balanc between  perform (impact on the applic) and the recoveri point or data loss when the switchov occur to the remot data center. to achiev thi, we allow the storag to be replic asynchron, prior to ani initi of the mainten event, or, assum the amount of data to be transfer is rel small, asynchron replic can be start in anticip of a migrat that is  expect to happen shortli. asynchron replic dure thi initi phase allow for the applic to see no perform  impact. howev, when the mainten event is immin, the mm would signal to the replic system to switch from asynchron replic to synchron replic to ensur that there is no loss of data dure migrat. when data is be replic  synchron, there will be a perform impact on the applic. 264 figur 1: live server migrat across a wan thi requir us to keep the exposur to the amount of time we replic on a synchron basi to a minimum. when the mm signal to the storag system the requir to switch to synchron replic, the storag system complet all the pend asynchron oper and then proce to  perform all the subsequ write by synchron replic it to the remot data center. thu, between the server migrat and synchron replic, both the applic state and all the  storag oper ar mirror at the two environ in the two data center. when all the pend write oper ar copi over, then as in the previou case, we quiesc the applic and the network is signal to switch traffic over to the remot data center. from thi point on, both storag and server migrat oper ar complet and activ in data center b. as abov, the network state still need to be updat to ensur optim data flow directli to data center b. note that while we have describ the live server migrat  process as involv the servic provid for the network part, it is possibl for a data center provid to perform a similar set of function without involv the servic provid. specif, by creat a tunnel between the custom edg (ce) router in the data center, and perform local switch on the appropri ce, rather than on the pe, the data center provid can realiz the same function. 3.2 unplan outag we propos to also us cooper, context awar migrat to deal with unplan data center outag. there ar multipl  consider that go into manag data center oper to plan and overcom failur through migrat. some of these ar: (1) amount of overhead under normal oper to overcom  anticip failur; (2) amount of data loss afford (recoveri point object - rpo); (3) amount of state that ha to be migrat; and (4) time avail from anticip failur to occurr of event. at the on extrem, on might incur the overhead of complet mirror the applic at the remot site. thi ha the  consequ of both incur process and network overhead under normal oper as well as impact applic perform  (latenc and throughput) throughout. the other extrem is to onli  ensur data recoveri and to start a new copi of the applic at the remot site after an outag. in thi case, applic memori state such as ongo session ar lost, but data store on disk is  replic and avail in a consist state. neither thi hot standbi nor the cold standbi approach describ ar desir due to the overhead or the loss of applic memori state. an intermedi approach is to recov control and essenti state of the applic, in addit to data store on disk, to further  minim disrupt to user. a spectrum of approach ar possibl. in a voip server, for instanc, session-base inform can be mirror without mirror the data flow through each session. more gener, thi point to the need to checkpoint some  applic state in addit to mirror data on disk. checkpoint  applic state involv store applic state either period or in an applic-awar manner like databas do and then  copi it to the remot site. of cours, thi ha the consequ that the applic can be restart remot at the checkpoint  boundari onli. similarli, for storag on mai us asynchron  replic with a period snapshot ensur all write ar up-to-date at the remot site at the time of checkpoint. some data loss mai occur upon an unanticip, catastroph failur, but the  recoveri point mai be fairli small, depend on the frequenc of checkpoint applic and storag state. coordin between 265 the checkpoint of the applic state and the snapshot of  storag is kei to success migrat while meet the desir rpo. increment checkpoint of applic and storag is kei to  effici, and we see exist techniqu to achiev thi [4, 3, 11]. for instanc, rather than full applic mirror, a virtual replica can be maintain as a warm standbi-in dormant or hibern state-enabl a quick switch-over to the previous checkpoint state. to make the switch-over seamless, in addit to replic data and recov state, network support is need. specif, on detect the unavail of the primari site, the secondari site is made activ, and the same mechan describ in section 3.1 is us to switch traffic over to reach the secondari site via the pre-establish tunnel. note that for simplic of  exposit we assum here that the pe that perform the local switch over is not affect by the failur. the approach can howev,  easili be extend to make us of a switchov at a router deeper in the network. the amount of state and storag that ha to be migrat mai vari wide from applic to applic. there mai be mani  situat where, in principl, the server can be stateless. for exampl, a sip proxi server mai not have ani persist state and the  commun between the client and the proxi server mai be us udp. in such a case, the primari activ to be perform is in the network to move the commun over to the new data  center site. littl or no overhead is incur under normal oper to enabl the migrat to a new data center. failur recoveri involv no data loss and we can deal with near instantan, catastroph failur. as more and more state is involv with the server, more  overhead is incur to checkpoint applic state and potenti to take storag snapshot, either period or upon applic prompt. it also mean that the rpo is a function of the  interv between checkpoint, when we have to deal with instantan failur. the more advanc inform we have of an impend failur, the more effect we can be in have the state migrat over to the new data center, so that we can still have a tighter rpo when oper ar resum at the new site. 4. relat work prior work on thi topic fall into sever categori: virtual  machin migrat, storag replic and network support. at the core of our techniqu is the abil of encapsul  applic within virtual machin that can be migrat without  applic downtim [15]. most virtual machin softwar, such as xen [8] and vmware [14] support live migrat of vm that involv extrem short downtim rang from ten of millisecond to a second; detail of xen"s live migrat techniqu ar discuss in [8]. as indic earlier, these techniqu assum that migrat is be done on a lan. vm migrat ha also been studi in the shirako system [10] and for grid environ [17, 19]. current virtual machin softwar support a suspend and resum featur that can be us to support wan migrat, but with  downtim [18, 12]. recent live wan migrat us ip tunnel wa demonstr in [21], where an ip tunnel is set up from the sourc to destin server to transpar forward packet to and from the applic; we advoc an altern approach that assum edg router support. in the context of storag, there exist numer commerci  product that perform replic, such as ibm extend remot copi, hp continu access xp, and emc replistor. an excel  descript of these and other, as well as a detail taxonomi of the differ approach for replic can be found in [11]. the ursa minor system argu that no singl fault model is optim for all applic and propos support data-type specif select of fault model and encod scheme for replic [1]. recent, we propos the notion of semant-awar replic [13] where the system support both synchron and asynchron  replic concurr and us signal from the file system to  determin whether to replic a particular write synchron and asynchron. in the context of network support, our work is relat to the routerfarm approach [2], which make us of orchestr  network chang to realiz near hitless mainten on provid edg router. in addit to be in a differ applic area, our approach differ from the routerfarm work in two regard. first, we propos to have the requir network chang be trigger by function outsid of the network (as oppos to network  manag function insid the network). second, due to the stringent time requir of live migrat, we expect that our approach would requir new router function (as oppos to be  realiz via the exist configur interfac). final, the recoveri orient comput (roc) work  emphas recoveri from failur rather than failur avoid [6]. in a similar spirit to roc, we advoc us mechan from live vm migrat to storag replic to support plan and unplan outag in data center (rather than full replic to mask such failur). 5. conclus a signific concern for internet-base servic provid is the continu oper and avail of servic in the face of  outag, whether plan or unplan. in thi paper we advoc a cooper, context-awar approach to data center migrat across wan to deal with outag in a non-disrupt manner. we sought to achiev high avail of data center servic in the face of both plan and incident outag of data center  facil. we advoc us server virtual technolog to  enabl the replic and migrat of server function. we propos new network function to enabl server migrat and replic across wide area network (such as the internet or a geograph distribut virtual privat network), and final show the util of intellig and dynam storag replic technolog to ensur applic have access to data in the face of outag with veri tight recoveri point object. 6. refer [1] m. abd-el-malek, w. v. courtright ii, c. cranor, g. r. ganger, j. hendrick, a. j. klosterman, m. mesnier, m. prasad, b. salmon, r. r. sambasivan, s. sinnamohideen, j. d. strunk, e. thereska, m. wach, and j. j. wyli. ursa minor: versatil cluster-base storag. usenix confer on file and storag technolog, decemb 2005. [2] mukesh agraw, susan bailei, albert greenberg, jorg pastor, panagioti sebo, srinivasan seshan, kobu van der merw, and jennif yate. routerfarm: toward a dynam, manag network edg. sigcomm workshop on internet network manag (inm), septemb 2006. [3] l. alvisi. understand the messag log paradigm for mask process crash. phd thesi, cornel, januari 1996. [4] l. alvisi and k. marzullo. messag log: pessimist, optimist, and causal. in proceed of the 15th intern confer on distribut comput system, page 229-236. ieee comput societi, june 1995. 266 [5] paul barham, bori dragov, keir fraser, steven hand, tim harri, alex ho, rolf neugebar, ian pratt, and andrew warfield. xen and the art of virtual. in the proceed of the acm symposium on oper system principl (sosp), octob 2003. [6] a. brown and d. a. patterson. embrac failur: a case for recoveri-orient comput (roc). 2001 high perform transact process symposium, octob 2001. [7] k. brown, j. katcher, r. walter, and a. watson. snapmirror and snaprestor: advanc in snapshot technolog. network applianc technic report tr3043. www. ne t app. c om/t e c h_ l i br ar y/3043. ht ml . [8] c. clark, k. fraser, s. hand, j. hans, e. jul, c. limpach, i. pratt, and a. warfiel. live migrat of virtual machin. in proceed of nsdi, mai 2005. [9] disast recoveri journal. busi continu glossari. ht t p: //www. dr j . c om/gl os s ar y/dr j gl os s ar y. ht ml . [10] laura grit, david irwin, , aydan yumerefendi, and jeff chase. virtual machin host for network cluster: build the foundat for autonom orchestr. in in the first intern workshop on virtual technolog in distribut comput (vtdc), novemb 2006. [11] m. ji, a. veitch, and j. wilk. seneca: remot mirror done write. usenix 2003 annual technic confer, june 2003. [12] m. kozuch and m. satyanarayanan. internet suspend and resum. in proceed of the fourth ieee workshop on mobil comput system and applic, calicoon, ny, june 2002. [13] xiaotao liu, gal niv, k. k. ramakrishnan, prashant shenoi, and jacobu van der merw. the case for semant awar remot replic. in proc. 2nd intern workshop on storag secur and surviv (storagess 2006), alexandria, va, octob 2006. [14] michael nelson, beng-hong lim, and greg hutchin. fast transpar migrat for virtual machin. in usenix annual technic confer, 2005. [15] mendel rosenblum and tal garfinkel. virtual machin monitor: current technolog and futur trend. comput, 38(5):39-47, 2005. [16] c. ruemmler and j. wilk. unix disk access pattern. proceed of winter 1993 usenix, jan 1993. [17] paul ruth, junghwan rhee, dongyan xu, rick kennel, and sebastien goasguen. autonom live adapt of virtual comput environ in a multi-domain infrastructur. in ieee intern confer on autonom comput (icac), june 2006. [18] constantin p. sapuntzaki, ramesh chandra, ben pfaff, jim chow, monica s. lam, and mendel rosenblum. optim the migrat of virtual comput. in proceed of the 5th symposium on oper system design and implement, decemb 2002. [19] a. sundararaj, a. gupta, and p. dinda. increas applic perform in virtual environ through run-time infer and adapt. in fourteenth intern symposium on high perform distribut comput (hpdc), juli 2005. [20] symantec corpor. verita volum replic administr"s guid. ht t p: //f t p. s uppor t . ve r i t as . c om/pub/s uppor t / pr oduc t s /vol um _ re pl i c at or /2%83842. pdf , 5.0 edit, 2006. [21] f. travostino, p. daspit, l. gomman, c. jog, c. de laat, j. mambretti, i. monga, b. van oudenaard, s. raghunath, and p. wang. seamless live migrat of virtual machin over the man/wan. elsevi futur gener comput system, 2006. [22] t. wood, p. shenoi, a. venkataramani, and m. yousif. black-box and grai-box strategi for virtual machin migrat. in proceed of the usenix symposium on network system design and implement (nsdi), cambridg, ma, april 2007. [23] a xen wai to iscsi virtual? http://www.internetnew.com/dev-new/articl.php/3669246, april 2007. 267 